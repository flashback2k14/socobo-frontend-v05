<!-- Polymer -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<!-- Roboto Font -->
<link rel="import" href="../../bower_components/font-roboto/roboto.html">
<!-- Drawer Panel -->
<link rel="import" href="../../bower_components/core-drawer-panel/core-drawer-panel.html">
<link rel="import" href="../../bower_components/core-header-panel/core-header-panel.html">
<!-- Elements for Drawer Menu Panel -->
<link rel="import" href="../../bower_components/core-menu/core-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<!-- Toolbar -->
<link rel="import" href="../../bower_components/core-toolbar/core-toolbar.html">
<!-- Icon Sets -->
<link rel="import" href="../../bower_components/core-icons/core-icons.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<!-- Paper Effects -->
<link rel="import" href="../../bower_components/paper-shadow/paper-shadow.html">
<!-- Ripple Effect -->
<link rel="import" href="../../bower_components/paper-ripple/paper-ripple.html">
<!-- Route Controller -->
<link rel="import" href="../../bower_components/flatiron-director/flatiron-director.html">
<!-- Core Pages -->
<link rel="import" href="../../bower_components/core-pages/core-pages.html">
<!-- Circle Image View -->
<link rel="import" href="../../bower_components/image-mask/image-mask.html">
<!-- Toast -->
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<!-- Paper Menu Button -->
<link rel="import" href="../../bower_components/paper-menu-button/paper-menu-button.html">
<link rel="import" href="../../bower_components/paper-dropdown/paper-dropdown.html">
<link rel="import" href="../../bower_components/paper-dropdown/paper-dropdown-transition.html">

<!-- Own Socobo Elements -->
<link rel="import" href="../socobo-home/socobo-home.html">
<!-- Not needed with, if we use popups
<link rel="import" href="../socobo-signup/socobo-signup.html">
<link rel="import" href="../socobo-login/socobo-login.html">
-->
<link rel="import" href="../socobo-myprofile/socobo-myprofile.html">
<link rel="import" href="../socobo-myfridge/socobo-myfridge.html">
<link rel="import" href="../socobo-myrecipes/socobo-myrecipes.html">
<link rel="import" href="../socobo-bugreport/socobo-bugreport.html">
<link rel="import" href="../socobo-about/socobo-about.html">
<link rel="import" href="../socobo-popup/socobo-signup-popup.html">
<link rel="import" href="../socobo-popup/socobo-login-popup.html">


<polymer-element name="socobo-app">
  <template>
    <!--<template>-->
    <style>
      /*Default Element Settings*/
      :host {
        font-family: RobotoDraft, 'Helvetica Neue', Helvetica, Arial;
        margin-left: 10px;
      }

      /*Drawer Panel Style*/
      #core_drawer_panel {
        position: absolute;
        top: 0px;
        right: 0px;
        bottom: 0px;
        left: 0px;
      }

      [main] {
        height: 100%;
        min-width: 320px;
        box-sizing: border-box;
        background-color: rgb(221, 221, 221);
        box-shadow: rgba(0, 0, 0, 0.0980392) 0px 2px 4px, rgba(0, 0, 0, 0.0980392) 0px 0px 3px;
        overflow: auto;
      }

      [drawer] {
        height: 100%;
        box-sizing: border-box;
        background-color: rgb(255, 255, 255);
        box-shadow: rgba(0, 0, 0, 0.0980392) 0px 2px 4px, rgba(0, 0, 0, 0.0980392) 0px 0px 3px;
        overflow: auto;
      }

      #core_toolbar_main {
        color: rgb(255, 255, 255);
        fill: rgb(255, 255, 255);
        background-color: #526E9C;
      }

      #core_toolbar_drawer {
        color: rgb(255, 255, 255);
        fill: rgb(255, 255, 255);
        background-color: #4F7DC9;
      }

      .content {
        height: 100%;
        width: 100%;
      }

      /*core menu + item*/
      core-menu {
        color: #01579b;
        margin: 10px 0 0 0;
      }

      core-menu > paper-item {
        transition: all 200ms ease-in-out;
      }

      paper-item a {
        text-decoration: none;
        color: currentcolor;
        margin-left: 5px;
      }

      core-menu > paper-item.core-selected {
        background: #e1f5fe;
      }

      /*User Profile*/
      [drawer] image-mask {
        margin-left: 14px;
        margin-bottom: 5px;
      }

      [drawer] p {
        margin: 16px 0px 0px 10px;
        font-size: 14px;
      }

      /*Dropdown*/
      paper-dropdown {
        width: 150px;
      }

      paper-dropdown core-menu paper-item {
        margin: 0px;
        padding: 0px;
      }

      paper-dropdown core-menu paper-item core-icon, a {
        margin: 0px;
        padding: 0px;
      }

    </style>
    <!--##################-->
    <!-- Element Content  -->
    <!--##################-->
    <!-- Route controller -->
    <flatiron-director route="{{route}}" autoHash></flatiron-director>

    <!-- Drawer Panel -->
    <core-drawer-panel id="drawerPanel" responsiveWidth="600px" touch-action>

      <!-- Area: Drawer -->
      <core-header-panel mode="waterfall-tall" tallClass="medium-tall" shadow drawer>

        <!-- Area: Toolbar Drawer -->
        <div class="core-header">
          <core-toolbar id="core_toolbar_drawer" class="medium-tall" shadow>
            <span flex>Menu</span>
            <div class="bottom fit" horizontal layout>
              <!-- Profile Pic -->
              <image-mask shape="square" size="50" src="{{userPictureUrl}}" title="User Profile Picture"></image-mask>
              <!-- Profile Username -->
              <p flex>{{userName}}</p>
            </div>
          </core-toolbar>
        </div>

        <!-- Menu -->
        <div id="content">
          <core-menu valueattr="hash" selected="{{route}}" selectedModel="{{selectedPage}}">

            <template repeat="{{page in pages}}">
              <paper-item hash="{{page.hash}}" on-click="{{closeNavDrawer}}" noink>
                <core-icon icon="{{page.icon}}"></core-icon>
                <a href="#{{page.hash}}">{{page.name}}</a>
              </paper-item>
            </template>

          </core-menu>
        </div>
      </core-header-panel>

      <!-- Area: Main -->
      <core-header-panel mode="waterfall-tall" tallClass="medium-tall" shadow main>

        <!-- Area: Toolbar Main -->
        <div class="core-header">
          <core-toolbar id="core_toolbar_main" class="medium-tall" shadow>
            <paper-icon-button icon="menu" core-drawer-toggle></paper-icon-button>
            <span flex>socobo - social cookbook</span>
            <paper-icon-button icon="refresh" on-tap="{{refreshAction}}"></paper-icon-button>

            <paper-menu-button>
              <paper-icon-button icon="menu" noink></paper-icon-button>

              <paper-dropdown halign="right" duration="350" class="dropdown">
                <core-menu class="menu">
                  <paper-item on-click="{{showPopupSignup}}">
                    <core-icon icon="create"></core-icon>
                    <a>Signup</a>
                  </paper-item>
                  <paper-item on-click="{{showPopupLogin}}">
                    <core-icon icon="exit-to-app"></core-icon>
                    <a>Login</a>
                  </paper-item>
                  <paper-item on-click="{{logout}}">
                    <core-icon icon="close"></core-icon>
                    <a>Logout</a>
                  </paper-item>
                  <paper-item on-click="{{settingsAction}}">
                    <core-icon icon="settings"></core-icon>
                    <a>Settings</a>
                  </paper-item>
                </core-menu>
              </paper-dropdown>
            </paper-menu-button>

          </core-toolbar>
        </div>

        <!-- Area: Content -->
        <div class="content">
          <core-pages selected="{{route}}" valueattr="hash">

            <div hash="home">
              <socobo-home vertical layout center center-justified></socobo-home>
            </div>

            <!-- Not needed with, if we use popups

            <div hash="signup">
              <socobo-signup id="socoboSignUp"
                             on-signup-response-ok="{{signupOk}}"
                             on-signup-response-failed="{{signupFailed}}"
                             vertical layout center center-justified>
              </socobo-signup>
            </div>

            <div hash="login">
              <socobo-login id="socoboLogin"
                            on-login-response-ok="{{loginOk}}"
                            on-login-response-failed="{{loginFailed}}"
                            vertical layout center center-justified>
              </socobo-login>
            </div>
            -->

            <div hash="myprofile">
              <socobo-myprofile vertical layout center center-justified></socobo-myprofile>
            </div>

            <div hash="myfridge">
              <socobo-myfridge vertical layout center center-justified></socobo-myfridge>
            </div>

            <div hash="myrecipes">
              <socobo-myrecipes vertical layout center center-justified></socobo-myrecipes>
            </div>

            <div hash="bugreport">
              <socobo-bugreport vertical layout center center-justified></socobo-bugreport>
            </div>

            <div hash="about">
              <socobo-about vertical layout center center-justified></socobo-about>
            </div>

          </core-pages>

          <!-- Popup - Area -->
          <socobo-signup-popup id="socoboSignupPopup"
                               on-signup-response-ok="{{signupOk}}"
                               on-signup-response-failed="{{signupFailed}}">
          </socobo-signup-popup>

          <socobo-login-popup id="socoboLoginPopup"
                               on-login-response-ok="{{loginOk}}"
                               on-login-response-failed="{{loginFailed}}">
          </socobo-login-popup>
        </div>

        <socobo-signup-popup id="socoboSignupPopup"
                             on-signup-response-ok="{{signupOk}}"
                             on-signup-response-failed="{{signupFailed}}">
        </socobo-signup-popup>

        <paper-toast id="toast"
                     duration="1500"></paper-toast>

      </core-header-panel>
    </core-drawer-panel>
  </template>

  <script>
    Polymer('socobo-app', {
      /**
       * @variable: authToken
       * @datatype: String
       * @defaultValue: undefined
       * @description:
       * - ! usage unknown (at the moment :-))
       */
      authToken: undefined,

      /**
       * @variable: userName
       * @datatype: String
       * @defaultValue: 'Username'
       * @description:
       * - it's self-describing
       */
      userName: 'Username',

      /**
       * @variable: userPictureUrl
       * @datatype: String
       * @defaultValue: 'images/github.png'
       * @description:
       * - it's self-describing
       * - ! changing for production
       */
      userPictureUrl: 'images/github.png',

      /**
       * @variable: DEFAULT_ROUTE
       * @datatype: String
       * @defaultValue: 'home'
       * @description:
       * - default navigation start point in menu
       */
      DEFAULT_ROUTE: 'home',

      /**
       * @variable: pages
       * @datatype: array
       * @defaultValue: object w/ parameter name, icon, hash
       * @description:
       * - set the navigation menu
       * - name: visual Name for menu item
       * - icon: icon for menu item
       * - hash: used for navigation
       */
      pages: [
        {name: 'Home', icon: 'home', hash: 'home'},
        /*{name: 'Signup', icon: 'create', hash: 'signup'},     //Not needed with, if we use popups
        {name: 'Login', icon: 'exit-to-app', hash: 'login'},*/  //Not needed with, if we use popups
        {name: 'My Profile', icon: 'account-circle', hash: 'myprofile'},
        {name: 'My Fridge', icon: 'dashboard', hash: 'myfridge'},
        {name: 'My Recipes', icon: 'assignment', hash: 'myrecipes'},
        {name: 'Report a Bug', icon: 'bug-report', hash: 'bugreport'},
        {name: 'About', icon: 'info', hash: 'about'}
      ],

	    /**
       * @function: ready
       * @params:
       * @description:
       * - default polymer function
       * - is called after component is fully loaded
       * - sets the route for navigation
       */
      ready: function() {

        document.cookie.split('; ').forEach(function(cookieString) {
          var cookie;
          cookie = cookieString.split("=");

          if ((cookie.length === 2) && (cookie[0] === "authToken")) {
            return window.authToken = cookie[1];
          }
        });

        if (window.authToken !== null) {
          this.authToken = window.authToken;
        } else {
          this.$.socoboLoginPopup.showPopup();
        }

        this.route = this.route || this.DEFAULT_ROUTE;
      },

      /**
       * @function: showPopupSignup
       * @params:
       * @description:
       * - show Signup Form as popup window
       */
      showPopupSignup: function() {
        this.$.socoboSignupPopup.showPopup();
      },

      /**
       * @function: signupOk
       * @params: e - event
       * @description:
       * - is called from socobo-signup if the signup was successfully
       * - sets the Username and Profile picture to the local variable
       * - sets the Username and Profile picture to the Toolbar
       * - redirects to socobo-home
       */
      signupOk: function(e) {
        this.userName = e.detail.username;
        this.userPictureUrl = e.detail.pictureurl;

        this.$.socoboSignupPopup.closePopup();

        this.route = 'home';
      },

      /**
       * @function: signupFailed
       * @params:
       * @description:
       * - is called from socobo-signup if the signup failed
       * - sets the Username and Profile picture to the Toolbar
       * - shows a toast message to inform the user
       * - ? redirects to socobo-signup (maybe unnecessary)
       */
      signupFailed: function(e) {
        var statusCode = e.detail.statusCode;
        this.$.toast.text = 'Signup failed! Statuscode: ' + statusCode;
        this.$.toast.show();
        //this.route = 'signup';    //Not needed with, if we use popups
      },

      /**
       * @function: showPopupLogin
       * @params:
       * @description:
       * - show Login Form as popup window
       */
      showPopupLogin: function() {
        this.$.socoboLoginPopup.showPopup();
      },

      /**
       * @function: loginOk
       * @params: e - event
       * @description:
       * - is called from socobo-login if the login was successfully
       * - sets the authToken to the local variable
       * - redirects to socobo-home
       * - ! at the moment no specific use for authToken
       */
      loginOk: function(e) {
        this.authToken = e.detail.authToken;
        this.route = 'home';
      },

      /**
       * @function: loginFailed
       * @params: e - event
       * @description:
       * - is called from socobo-login if the login failed
       * - shows a toast message to inform the user
       * - ? redirects to socobo-login (maybe unnecessary)
       */
      loginFailed: function(e) {
        var statusCode = e.detail.statusCode;
        this.$.toast.text = 'Login failed! Statuscode: ' + statusCode;
        this.$.toast.show();
        //this.route = 'login';     //Not needed with, if we use popups
      },

      /**
       * @function: closeNavDrawer
       * @params:
       * @description:
       * - close Drawer after Menu item click
       */
       closeNavDrawer: function() {
         this.$.drawerPanel.closeDrawer();
       },

      /**
       * @function: refreshAction
       * @params:
       * @description:
       * - shows a toast message to inform the user
       * - ! at the moment no functionality
       */
      refreshAction: function() {
        this.$.toast.text = 'Refreshing Page...';
        this.$.toast.show();
      },

      /**
       * @function: logout
       * @params:
       * @description:
       * - shows a toast message to inform the user
       * - ! at the moment no functionality
       */
      logout: function() {
        this.$.toast.text = 'Logging out...';
        this.$.toast.show();
      },

      /**
       * @function: settingsAction
       * @params:
       * @description:
       * - shows a toast message to inform the user
       * - ! at the moment no functionality
       */
      settingsAction: function() {
        this.$.toast.text = 'Settings...';
        this.$.toast.show();
      }
    });
  </script>
</polymer-element>
