<link rel="import" href="../../bower_components/core-icon-button/core-icon-button.html">
<link rel="import" href="../../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/core-icons/core-icons.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">


<polymer-element name="socobo-signup">

  <template>
    <style>
      :host {
        font-family: RobotoDraft, 'Helvetica Neue', Helvetica, Arial;
        margin-left: 10px;
      }

      #core_card_signup {
        margin-top: 50px;
        width: 650px;
        height: 440px;
        border-radius: 2px;
        box-shadow: rgba(0, 0, 0, 0.0980392) 0px 2px 4px, rgba(0, 0, 0, 0.0980392) 0px 0px 3px;
        background-color: rgb(255, 255, 255);
      }

      #core_toolbar_signup {
        right: 0px;
        color: rgb(255, 255, 255);
        fill: rgb(255, 255, 255);
        background-color: rgb(79, 125, 201);
      }

      paper-input {
        width: 350px;
        height: 70px;
        margin: 2px 2px 2px 5px;
        padding: 2px 2px 2px 5px;
      }

      paper-fab {
        background-color: #e0a30b;
        position: absolute !important;
        bottom: 16px;
        right: 16px;
        z-index: 10;
      }
    </style>

    <paper-shadow z="2">
      <core-card id="core_card_signup" vertical layout>
        <paper-shadow z="1">
          <core-toolbar id="core_toolbar_signup">
            <div id="div" flex>SignUp</div>
          </core-toolbar>
        </paper-shadow>

        <paper-input id="paper_input_name"
                     type="text"
                     value="{{userName}}"
                     label="Enter your username..."
                     error="no name entered"
                     validationmessage="Please fill out this field."
                     floatinglabel willvalidate required></paper-input>

        <paper-input id="paper_input_email"
                     type="email"
                     value="{{email}}"
                     label="Enter your email address..."
                     error="no email address entered"
                     validationmessage="Please fill out this field."
                     floatinglabel willvalidate required></paper-input>

        <paper-input id="paper_input_password"
                     type="password"
                     value="{{password}}"
                     label="Enter your password..."
                     error="no password entered"
                     validationmessage="Please fill out this field."
                     floatinglabel willvalidate required></paper-input>

        <paper-input id="paper_input_password_again"
                     type="password"
                     value="{{passwordRepeat}}"
                     label="Enter your password again..."
                     error="no password entered"
                     validationmessage="Please fill out this field."
                     floatinglabel willvalidate required></paper-input>

        <paper-fab id="paper_fab_signup"
                   icon="send"
                   type="submit"
                   on-click="{{signUpSubmit}}"
                   recenteringtouch end></paper-fab>

        <core-ajax
    			id="socoboSignUpForm" url="/signup" method="POST"
    			params='{"userName":"{{userName}}", "email":"{{email}}", "password": "{{password}}", "passwordRepeat": "{{passwordRepeat}}"}'
    			handleAs="json"
    			response="{{resp}}"
    			on-core-response="{{handleRegisterResponse}}">
    		</core-ajax>

    		<!-- Testing -->
    		<textarea style="padding: 5px; margin: 5px; width: 60%" value="Username:{{resp.userName}}, Name: {{resp.name}}, Email: {{resp.email}}, PictureUrl: {{resp.pictureUrl}}"></textarea>

      </core-card>
    </paper-shadow>

    <paper-toast id="toast"
                 duration="1500"></paper-toast>

  </template>

  <script>

    Polymer('socobo-signup', {
      //fire form content to backend
      signUpSubmit: function(){
        this.$.socoboSignUpForm.go();
        this.$.toast.text = "SignUp submitted!";
        this.$.toast.show();
      },
      //handle response from backend
      handleRegisterResponse: function(e) {

        this.$.toast.text = "Response entered!";
        this.$.toast.show();

        var registerData = JSON.parse(e.detail.response.d);

        //console.log('Registerdata: ' + registerData);

        var username = registerData.userName;
    		var name = registerData.name;
    		var email = registerData.email;
    		var pictureUrl = registerData.pictureUrl;

    		console.log('Username ' + username);
    		console.log('Name ' + name);
    		console.log('Email ' + email);
    		console.log('PictureUrl ' + pictureUrl);

    		this.fire('signup-response-profile', {username: this.username, pictureurl: this.pictureUrl});
      }
    });

  </script>

</polymer-element>
